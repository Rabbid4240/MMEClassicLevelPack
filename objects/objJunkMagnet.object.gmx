<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprJunkMagnet</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtRailPlatform</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
canHit = false;
isSolid = 1;

hasSwitch = false;

respawnRange = -1;
despawnRange = -1;

blockCollision = 0;

grav = 0;
faction = 0;
behaviourType = 3;

freeFalling = false;

distance = 64;
magnetizing = false;
magnetJunkTarget = noone;
magnetPlayerTarget = noone;

myFlag = 0;

xspeed = 0;
yspeed = 0;

mySpeed = 0;
xOffset = 0;
yOffset = -9;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
faction = 3;
setTargetStep();
faction = 0;
if (false)
{
    if (false /* place_meeting(x, y - 8, prtRail )*/ )
    {
        ystart -= 8;
        y = ystart;
    }
    else if (false /* positionCollision(x, y - 1) &amp;&amp; !positionCollision(x, y + 3 )*/ )
    {
        ystart -= 4;
        y = ystart;
    }
}
if (!hasSwitch)
{
    with (objSwitchHandler)
    {
        if (myFlag == other.myFlag)
        {
            other.hasSwitch = true;
        }
    }
}

if (!global.frozen &amp;&amp; !dead &amp;&amp; !global.timeStopped)
{
    isSolid = 1;
    
    if (false /* positionCollision(x, y - 9) &amp;&amp; !freeFalling */ )
    {
        yspeed = 0;
        dir = "onsolid";
    }
    else
    {
        if (dir == "fall")
        {
            isSolid = 2;
            mySpeed = 0;
            freeFalling = true;
        }
        else
        {
            freeFalling = false;
            mySpeed = 0.8;
        }
    }
    if (hasSwitch)
    {
        if (global.flagParent[myFlag].active)
        {
            mySpeed = 0.8;
            
            // Image stuff.
            image_speed = 1 / 4;
            if (magnetizing)
            {
                if (image_index &lt;= 5 || image_index &gt;= 8)
                {
                    image_index = 6;
                }
            }
            else
            {
                if (image_index &lt;= 0 || image_index &gt;= 6)
                {
                    image_index = 1;
                }
            }
            
            // Movement stuff.
            /* if (xcoll != 0)
            {
                image_xscale *= -1;
            }
            */
            if (place_meeting(x, y, objJunkMagnet))
            {
                if (dir == "left")
                    dir = "right";
                else if (dir == "right")
                    dir = "left";
                else if (dir == "up")
                    dir = "down";
                else if (dir == "down")
                    dir = "up";
                xspeed = -xspeed;
                yspeed = -yspeed;
            }
            
            /*
            if (positionCollision(x, y))
            {
                if (!positionCollision(x + 8 * image_xscale, y)
                    &amp;&amp; !place_meeting(x + 8 * image_xscale, y, prtRail))
                {
                    image_xscale *= -1;
                }
                if (place_meeting(x + 4 * image_xscale, y objLiftEnd))
                {
                    image_xscale *= -1;
                }
                xspeed = 0.8 * image_xscale;
            }
            else if (place_meeting(x, y-9, prtRail))
            {
                if (place_meeting(x + 4 * image_xscale, y, objLiftEnd))
                {
                    image_xscale *= -1;
                }
                if (dir == "left")
                {
                    image_xscale = -1;
                }
                else if (dir == "right")
                {
                    image_xscale = 1;
                }
            }
            */
            
            
            // Magnetizing Mega Man.
            if (!instance_exists(magnetPlayerTarget))
            {
                with (objMegaman)
                {
                    if (!dead &amp;&amp; bbox_top &gt;= other.bbox_bottom + 2
                        &amp;&amp; distance_to_object(other) &lt; other.distance
                        &amp;&amp; abs(x - other.x) &lt;= 16 &amp;&amp; !ground)
                    {
                        other.magnetizing = true;
                        other.magnetPlayerTarget = id;
                    }
                }
            }
            
            // Magnetism.
            if (magnetizing)
            {
                if (instance_exists(magnetPlayerTarget)
                    &amp;&amp; (instance_exists(lastRail) &amp;&amp; !lastRail.drop)
                    &amp;&amp; dir != "fall")
                {
                    // Player magnetism.
                    with (magnetPlayerTarget)
                    {
                        if (!dead &amp;&amp; bbox_top &gt;= other.bbox_bottom + 2
                            &amp;&amp; distance_to_object(other) &lt; other.distance
                            &amp;&amp; abs(x - other.x) &lt;= 16 &amp;&amp; !ground)
                        {
                            if (other.bbox_bottom + 2 - bbox_top &lt; -(yspeed + 2))
                            {
                                shiftObject(0, abs(yspeed + 2) * -1, true);
                            }
                            else
                            {
                                shiftObject(0, other.bbox_bottom + 2 - bbox_top, true);
                            }
                            if ((x - other.x) * other.xspeed &lt; 0)
                            {
                                shiftObject(1.2 * sign(other.x - x), 0, true);
                            }
                            else if (other.xspeed == 0)
                            {
                                if (abs(x - other.x) &gt; 1.2)
                                {
                                    shiftObject(1.2 * sign(other.x - x), 0, true);
                                }
                                else
                                {
                                    shiftObject(abs(x - other.x) * sign(other.x - x), 0, true);
                                }
                            }
                            yspeed = 0;
                        }
                        else
                        {
                            other.magnetPlayerTarget = noone;
                        }
                    }
                }
                else
                {
                    magnetPlayerTarget = noone;
                }
                
                // Junk magnetism.
                if (instance_exists(magnetJunkTarget)
                    &amp;&amp; (instance_exists(lastRail) &amp;&amp; !lastRail.drop)
                    &amp;&amp; dir != "fall")
                {
                    with (magnetJunkTarget)
                    {
                        mp_linear_step(other.x, other.bbox_bottom + 2, 2, false);
                    }
                    if (magnetJunkTarget.magnetState &gt;= 3)
                    {
                        magnetJunkTarget = noone;
                    }
                }
                else
                {
                    magnetJunkTarget = noone;
                }
                
                // No magnetism.
                if (!instance_exists(magnetPlayerTarget)
                    &amp;&amp; !instance_exists(magnetJunkTarget))
                {
                    magnetizing = false;
                }
            }
            else if (instance_exists(lastRail) &amp;&amp; !lastRail.drop
                &amp;&amp; dir != "fall")
            {
                // Magnetizing junk.
                if (!instance_exists(magnetPlayerTarget))
                {
                    if (!instance_exists(magnetJunkTarget))
                    {
                        with (objJunkMagDebris)
                        {
                            if (!dead &amp;&amp; bbox_top &gt; other.bbox_bottom + 2
                                &amp;&amp; distance_to_object(other) &lt; other.distance
                                &amp;&amp; !place_meeting(x, y - 1, objMegaman)
                                &amp;&amp; !instance_exists(myMagnet) &amp;&amp; magnetState == 0)
                            {
                                other.magnetJunkTarget = id;
                                other.magnetizing = true;
                                magnetState = 1;
                                myMagnet = other.id;
                            }
                        }
                    }
                }
            }
        }
        else
        {
            image_index = 0;
            image_speed = 0;
            xspeed = 0;
            magnetizing = false;
            magnetPlayerTarget = noone;
            magnetJunkTarget = noone;
            mySpeed = 0;
        }
    }
    else
    {
        image_index = 0;
        image_speed = 0;
        xspeed = 0;
        magnetizing = false;
        magnetPlayerTarget = noone;
        magnetJunkTarget = noone;
    }
}
else if (dead)
{
    image_index = 0;
    image_speed = 0;
    xspeed = 0;
    magnetizing = false;
    magnetPlayerTarget = noone;
    magnetJunkTarget = noone;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
